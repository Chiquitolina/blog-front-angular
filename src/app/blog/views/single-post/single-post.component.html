<div class="container">
  <div class="row d-flex justify-content-around g-0">
    <!-- Columna de post principal (debe estar primero en móviles) -->
    <div class="col-xl-6 order-1 order-md-2 col-md-8 d-flex h-25 flex-column align-items-center post-side">
      @if (isLoadingSinglePost()) {
      <mat-spinner color="primary"></mat-spinner>
      } @else {
      <img class="w-100 post-img mb-3" src="{{ post?.img }}" alt="" />
      <div class="info">
        <div class="d-flex justify-content-between flex-column mb-4">
          <span class="mt-2 category d-flex rounded w-50">{{
            post?.categoria
            }}</span>

          <span class="mt-2 w-75 text-secondary subcategory d-flex rounded">{{
            post?.subcategoria
            }}</span>
        </div>
        <b class="century mt-3 post-title">{{ post?.titulo }}</b>
        <div class="w-100 d-flex justify-content-between mt-4">
          <div class="d-flex align-items-center datee rounded">
            <mat-icon class="d-flex align-items-center" style="font-size: 1.15rem;">calendar_today</mat-icon>
            <i class="mt-1" style="font-size: 12px">{{
              post?.createdAt | date : "MMMM d, y"
              }}</i>
          </div>
          <form class="rounded w-50 d-flex justify-content-center av-rat" [formGroup]="formGroup">
            <p-rating (click)="openDialog()" formControlName="rating" />
            <!-- <p class="mt-2 av-rat">
              Average Rating:
              {{ this.post?.avgRating }}
            </p> -->
          </form>
        </div>
        <div class="mt-4 mb-3 post-content" [innerHTML]="post?.contenido"></div>
        <!-- <div class="d-flex align-items-center p-2">
          <b class="century share">Compartí este post</b>
          <div class="share-img-cont">
            <img
              (click)="compartirEnLinkedIn()"
              class="share-img"
              src="/assets/lin-logo.png"
              alt=""
            />
          </div>
          <div class="share-img-cont">
            <img class="share-img" src="/assets/twitter-logo.png" alt="" />
          </div>
        </div> -->
      </div>
      }
    </div>

    <!-- Columna de post recientes -->
    <div class="col-xl-4 col-md-12 order-2 order-md-1 d-xl-block d-md-none d-sm-none d-none">
      <h2 class="century mb-4 side">Posts recientes</h2>
      @if (!recentPosts) {
      <div>
        <div class="skeleton-card">
          <!-- Bloque principal (cuadrado o rectángulo) -->
          <ngx-skeleton-loader [theme]="{
            width: '25rem',
            height: '17rem',
            'border-radius': '8px',
            'background-color': '#a2a2a2',
          }"></ngx-skeleton-loader>

          <!-- Loader circular por encima o dentro (avatar, ícono, etc) -->
          <div class="circle-overlay">
            <ngx-skeleton-loader [theme]="{
                width: '12rem',
                height: '1.5rem',
                'background-color': '#ccc'
              }"></ngx-skeleton-loader>
          </div>
          <div class="circle-overlayy">
            <ngx-skeleton-loader [theme]="{
                width: '18rem',
                height: '1.5rem',
                'background-color': '#ccc'
              }"></ngx-skeleton-loader>
          </div>
          <div class="circle-overlayyy">
            <ngx-skeleton-loader [theme]="{
                width: '9rem',
                height: '8rem',
                'background-color': '#ccc'
              }"></ngx-skeleton-loader>
          </div>
          <div class="circle-overlayyyy">
            <ngx-skeleton-loader [theme]="{
                width: '12.5rem',
                height: '1.5rem',
                'background-color': '#ccc'
              }"></ngx-skeleton-loader>
          </div>
        </div>
      </div>
      <div class="skeleton-card">
        <!-- Bloque principal (cuadrado o rectángulo) -->
        <ngx-skeleton-loader [theme]="{
            width: '25rem',
            height: '17rem',
            'border-radius': '8px',
            'background-color': '#a2a2a2',
          }"></ngx-skeleton-loader>

        <!-- Loader circular por encima o dentro (avatar, ícono, etc) -->
        <div class="circle-overlay">
          <ngx-skeleton-loader [theme]="{
              width: '12rem',
              height: '1.5rem',
              'background-color': '#ccc'
            }"></ngx-skeleton-loader>
        </div>
        <div class="circle-overlayy">
          <ngx-skeleton-loader [theme]="{
              width: '18rem',
              height: '1.5rem',
              'background-color': '#ccc'
            }"></ngx-skeleton-loader>
        </div>
        <div class="circle-overlayyy">
          <ngx-skeleton-loader [theme]="{
              width: '9rem',
              height: '8rem',
              'background-color': '#ccc'
            }"></ngx-skeleton-loader>
        </div>
        <div class="circle-overlayyyy">
          <ngx-skeleton-loader [theme]="{
              width: '12.5rem',
              height: '1.5rem',
              'background-color': '#ccc'
            }"></ngx-skeleton-loader>
        </div>
      </div>
      } @for (recentPost of recentPosts; let i = $index; track recentPost) {

      <div class="d-flex align-items-center justify-content-around row sidepost bg-white rounded p-2"
        [ngStyle]="{ 'animation-delay': i * 0.2 + 's' }">
        <div class="d-flex justify-content-between flex-column mb-2">
          <span class="mt-2 category d-flex rounded w-50">{{
            recentPost.categoria
            }}</span>

          <span class="mt-2 w-75 text-secondary subcategory d-flex rounded">{{
            recentPost.subcategoria
            }}</span>
        </div>
        <div class="col-6 mt-2 mb-2">
          <img class="rounded border w-100" style="height: 9rem" src="{{ recentPost.img }}" alt="" />
        </div>
        <div class="col-6 mt-2 mb-2">
          <a href="" [routerLink]="['/post', recentPost.id]">
            <h3 class="century text-end" style="font-weight: 600">
              {{ recentPost.titulo }}
            </h3>
          </a>
        </div>
        <div class="d-flex align-items-center justify-content-end">
          <!--  <div class="d-flex align-items-center justify-content-center mt-2">
            <mat-icon style="font-size: 1rem" class="mt-1">calendar_today</mat-icon>
            <i style="font-size: 12px">{{
              recentPost.createdAt | date : "MMMM d, y"
              }}</i>
          </div>-->
          <form style="width: 45%" class="rounded d-flex justify-content-center mb-2 av-rat">
            <p-rating [readonly]="true" [(ngModel)]="recentPost.avgRating" name="avgRating" />
          </form>
        </div>
      </div>
      <hr />
      }
      <h2 class="mt-5 century">Categorías Top</h2>
      @for (category of mostRankedCategories; track category) {
      <div class="mt-4">
        <h3 class="century text-secondary">
          0{{ mostRankedCategories.indexOf(category) + 1 }}/
          {{ category.categoria }}
        </h3>
      </div>
      }
    </div>
    <app-recent-post-carousel class="d-xl-none d-md-block d-sm-block d-block order-2 order-md-2 mt-5 col-md-8"
      [recentPosts]="recentPosts"></app-recent-post-carousel>
  </div>
</div>
<div>
  <app-posts-display></app-posts-display>
</div>
<app-confirm-rating-dialog (afterRated)="uploadRate()" [visible]="isDialogVisible"
  [data]="{ rating: formGroup.get('rating')?.value, postId: post?.id }" (visibleChange)="onDialogClosed()">
</app-confirm-rating-dialog>